{{ define "main" }}
<div class="login-container">
    <h1>Account Access</h1>
    <form id="auth-form" novalidate>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" required>
            <div class="error-message" id="email-error"></div>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" required minlength="6">
            <div class="error-message" id="password-error"></div>
        </div>
        <div class="form-group checkbox">
            <label>
                <input type="checkbox" id="remember-me">
                Remember me
            </label>
        </div>
        <div class="button-group">
            <button type="submit" id="sign-in-button">Sign In</button>
            <button type="button" id="create-account-button">Create Account</button>
        </div>
    </form>
    <button id="reset-password-button" class="text-button">Forgot Password?</button>
    <div class="social-login">
        <button id="google-sign-in">Sign in with Google</button>
    </div>
    <div id="message" class="message"></div>
</div>

<style>
    .login-container {
        font-family: Arial, sans-serif;
        max-width: 400px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1 {
        color: #333;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    label {
        display: block;
        margin-bottom: 0.5rem;
        color: #555;
    }
    input[type="email"],
    input[type="password"] {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .checkbox {
        display: flex;
        align-items: center;
    }
    .checkbox input {
        margin-right: 0.5rem;
    }
    .button-group {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
    }
    button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        background-color: #4285F4;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 1rem;
    }
    button:hover {
        background-color: #357AE8;
    }
    .error-message {
        color: #D32F2F;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    .message {
        margin-top: 1rem;
        padding: 0.5rem;
        border-radius: 4px;
        text-align: center;
    }
    .message.error {
        background-color: #FFCDD2;
        color: #D32F2F;
    }
    .message.success {
        background-color: #C8E6C9;
        color: #388E3C;
    }
    .text-button {
        background: none;
        color: #4285F4;
        text-decoration: underline;
        padding: 0;
        margin-top: 1rem;
    }
    .social-login {
        margin-top: 1rem;
        text-align: center;
    }
    #google-sign-in {
        background-color: #DB4437;
    }
    #google-sign-in:hover {
        background-color: #C31C0D;
    }
</style>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('auth-form');
    const createAccountButton = document.getElementById('create-account-button');
    const resetPasswordButton = document.getElementById('reset-password-button');
    const googleSignInButton = document.getElementById('google-sign-in');
    const messageElement = document.getElementById('message');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (validateForm()) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            signIn(email, password, rememberMe);
        }
    });

    createAccountButton.addEventListener('click', function() {
        if (validateForm()) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            createAccount(email, password);
        }
    });

    resetPasswordButton.addEventListener('click', function() {
        const email = document.getElementById('email').value;
        if (email) {
            sendPasswordResetEmail(email);
        } else {
            setMessage('Please enter your email address.', 'error');
        }
    });

    googleSignInButton.addEventListener('click', function() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider)
            .then((result) => {
                setMessage('Signed in with Google successfully. Redirecting...', 'success');
                redirectToDashboard();
            }).catch((error) => {
                setMessage('Google sign-in error: ' + error.message, 'error');
            });
    });

    function validateForm() {
        let isValid = true;
        const email = document.getElementById('email');
        const password = document.getElementById('password');

        if (!email.validity.valid) {
            setFieldError(email, 'Please enter a valid email address.');
            isValid = false;
        } else {
            clearFieldError(email);
        }

        if (!password.validity.valid) {
            setFieldError(password, 'Password must be at least 6 characters long.');
            isValid = false;
        } else {
            clearFieldError(password);
        }

        return isValid;
    }

    function setFieldError(field, message) {
        field.classList.add('error');
        const errorElement = document.getElementById(field.id + '-error');
        errorElement.textContent = message;
    }

    function clearFieldError(field) {
        field.classList.remove('error');
        const errorElement = document.getElementById(field.id + '-error');
        errorElement.textContent = '';
    }

    function signIn(email, password, rememberMe) {
        firebase.auth().setPersistence(rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION)
            .then(() => {
                return firebase.auth().signInWithEmailAndPassword(email, password);
            })
            .then((userCredential) => {
                setMessage('Signed in successfully. Redirecting...', 'success');
                redirectToDashboard();
            })
            .catch((error) => {
                setMessage('Sign-in error: ' + error.message, 'error');
            });
    }

    function createAccount(email, password) {
        firebase.auth().createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                setMessage('Account created successfully. Redirecting...', 'success');
                redirectToDashboard();
            })
            .catch((error) => {
                setMessage('Account creation error: ' + error.message, 'error');
            });
    }

    function sendPasswordResetEmail(email) {
        firebase.auth().sendPasswordResetEmail(email)
            .then(() => {
                setMessage('Password reset email sent. Please check your inbox.', 'success');
            })
            .catch((error) => {
                setMessage('Password reset error: ' + error.message, 'error');
            });
    }

    function setMessage(message, type) {
        messageElement.textContent = message;
        messageElement.className = 'message ' + type;
    }

    function redirectToDashboard() {
        setTimeout(() => {
            window.location.href = '/dashboard';
        }, 1500); // Delay for 1.5 seconds to show the success message
    }

    // Check initial auth state
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            setMessage('You are currently signed in. Redirecting...', 'success');
            redirectToDashboard();
        }
    });
});
</script>
{{ end }}